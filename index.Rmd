---
title: "Making maps of Ireland in R"
author: "Brendan O'Dowd"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This guide uses maps from my GitHub page produced using shapefiles from [OSi](https://data-osi.opendata.arcgis.com/) and [OSNI](https://www.spatialni.gov.uk/).
 
Two packages are used throughout, they are [tidyverse](https://tidyverse.tidyverse.org/) (actually a collection of packages) and [sf](https://r-spatial.github.io/sf/), which stands for simple features. To install any package run ```install.packages("package_name")```.

To start, we will need to load both of these packages.

```{r packages , message=FALSE}
library(tidyverse)
library(sf)
```

## Prerequisites

I would like for anyone to be able to begin making their own maps, but some familiarity with R is ideal. I think that in order to produce maps independently you should be able to use the following list of functions. The help function in R is very useful, you can find out about a function using ```?```, for example by entering ```?select```. 

- ```select()``` : subsetting columns
- ```filter()``` : subsetting rows
- ```mutate()``` : create new variables
- ```group_by()``` : prepares a dataframe for operations to be carried out on groups of variables. Use ```ungroup()``` to remove grouping.
- ```c()``` : create a vector.

Not an absolute necessity, but I find myself doing a lot of string matching when I'm making maps in R, and for that I use the ```str_detect()``` function. A very useful resource is the 'String manipulation with stringr cheatsheet', available on the [RStudio Cheatsheets page](https://www.rstudio.com/resources/cheatsheets/). 

## Importing maps

You **should** be able to import my maps directly from the web, using the following, which will create an object called ```lea_166```. This is an sf object, it is a special type of dataframe that has a column called geometry which contains the coordinates for the shapes. This is a map of the 166 Local Electoral Areas in Ireland, plus the outline for Northern Ireland, so there are 167 shapes in total and 167 rows in ```lea_166```.

I say **should** above because your organisation might not allow R to access the web in this way. If that's the case then you can navigate to the URL in the ```st_read()``` function, and save that page locally as a .geojson file. Then use the file location on your PC as the argument for ```st_read()```.


```{r import_map , message=FALSE , results="hide"}
lea_166 <- st_read("https://raw.githubusercontent.com/brendanjodowd/maps/main/lea_166.geojson")
```

We will be able to use this map to create other maps, such as county outlines and NUTS 3 region outlines, as we shall see.

There are 11 columns within ```lea_166```, they are:

- LE_ID : an id sometimes used by CSO
- LEA: The name of the LEA
- COUNTY: The county of the LEA
- AREA: area in square kilometres
- GUID: Globally Unique Identification code, another type of ID
- NUTS3 and NUTS2: NUTS (Nomenclature of Territorial Units for Statistics) regions are standard country subdivisions used for statistical purposes. 
- ADMIN_AREA: Ireland's 31 administrative areas. Like COUNTY, except Dublin, Cork, Galway and Limerick are broken up. 
- cso_name: a version of the name of the LEA which may be matched to CSO datasets
- Pop2016: The population of the LEA according to Census 2016 data.
- geometry: a list-column containing the geographic coordinates for each LEA.

Let's take a quick look at the map that we now have using ggplot. ggplot is one of the packages within tidyverse which is very useful for making all kinds of nice plots).

```{r first_plot , message=FALSE , results="hide"}
ggplot() + geom_sf(data= lea_166)
```

This structure of using ```ggplot()``` followed by ```geom_XXX()``` will be familiar to users of ggplot. 

Note that the following piece of code is equivalent, and doesn't require ```data = ```:

```{r first_plot_alternative , eval=FALSE }
ggplot(lea_166) + geom_sf()
```

I will be using the first format because later I will be using multiple ```geom_sf()``` functions to build up a plot in layers, and I find that the dataframe being used is less ambiguous that way. 

 


## Aggregating up for counties and NUTS regions

Maps for counties, admin areas, NUTS2 and NUTS3 regions can be produced using ```lea_166```. To produce a map of counties, for example, use the code below. The key function here is ```st_union()``` which can be used to join sf objects. 

```{r aggregating , message=FALSE , results="hide"}
county_map <- lea_166 %>% 
  group_by(COUNTY) %>% 
  summarise(geometry = st_union(geometry) , AREA=sum(AREA))
```

Note that ```county_map``` has only 3 columns, which are ```COUNTY```, ```geometry``` and ```AREA```. ```AREA``` is calculated for each county using the ```sum()``` function above. You could do something similar for ```Pop2016``` if you wished. All other columns are lost in the ```summarise()``` step.

Let's plot ```county_map``` to see what it looks like.

```{r county_plot , message=FALSE , results="hide"}
ggplot() + geom_sf(data=county_map)
```

Try making a similar plot of the NUTS3 regions.

##  Colouring in selected areas of the map

Let's start with the LEA map and let's say we want all of the LEAs in the Border 

