<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Home" />


<title>Statistical Disclosure Control using sdcTable</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">



<h1 class="title toc-ignore">Statistical Disclosure Control using sdcTable</h1>
<h4 class="author"><a href="https://brendanjodowd.github.io">Home</a></h4>

</div>


<div id="what-this-guide-is-about" class="section level2">
<h2>What this guide is about</h2>
<p>This is a guide for implementing Statistical Disclosure Controls (SDC) on tabular data using R with the <a href="https://cran.r-project.org/web/packages/sdcTable/vignettes/sdcTable.html">sdcTable package</a>. It will include a range of different circumstances that I have encountered.</p>
<p>This guide does not give a general overview on SDC. The CSO have produced a very good document on <a href="https://www.cso.ie/en/media/csoie/aboutus-new/dataforresearchers/CSO_Guidance_on_Tabular_SDC.docx">Best Practice for Statistical Disclosure Control of Tabular Data</a> (docx, 365KB).</p>
<p>Statistical Disclosure Controls are measures that protect against the publication of information relating to an individual person, company or organisation. Implementing robust SDC provides assurance to data providers that their data won’t be inadvertently made public. As mentioned already, this guide covers cell suppression in tabular outputs, which is generally required where certain cross-tabulations are sparsely populated. ‘Unsafe cells’ are identified for <em>primary suppression</em>. Usually other cells need to be suppressed too, so that the value of an unsafe cell cannot be deduced using the aggregate totals and remaining data, and this is called <em>secondary suppression</em>.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>As well as the <a href="https://cran.r-project.org/web/packages/sdcTable/vignettes/sdcTable.html">sdcTable package</a> for R, we will be using the <a href="https://tidyverse.tidyverse.org/">tidyverse</a> collection of packages throughout.</p>
<pre class="r"><code>library(tidyverse)
library(sdcTable)</code></pre>
<p>We will start with a dataset called <code>company_sales_1</code> which can be imported into R as a csv. This dataset contains sales information for 60 fictional companies located in Connaught. There are five columns, the ID and Name of each company, then the COunty in which it is located, a Y/N indicator to indicate if the company received some kind of aid, and the value of Sales for the year.</p>
<pre class="r"><code>company_sales_1 &lt;- read_csv(&quot;input/company_sales_1.csv&quot;)

head(company_sales_1)</code></pre>
<pre><code>## # A tibble: 6 x 5
##      ID Name              County Aid   Sales
##   &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt;
## 1     1 Jones Engineering Galway Y       779
## 2     2 Mike&#39;s Bakery     Galway Y       825
## 3     3 Falafel Inc       Galway Y       342
## 4     4 Galway Windows    Galway Y       563
## 5     5 Tuam Tech Ltd     Galway Y       328
## 6     6 Joe Farm Supplies Galway Y       184</code></pre>
</div>
<div id="simple-run-through" class="section level2">
<h2>Simple run-through</h2>
<p>Here we will produce aggregate sales data broken down across the two dimensions, County and Aid. We want aggregates for all Counties (“Connaught”) and all companies including those that did and did not receive aid.</p>
<p>The key steps are as follows:</p>
<ol style="list-style-type: decimal">
<li>Create hierarchies using <code>hier_create</code></li>
<li>Create sdcProblem object using <code>makeProblem</code></li>
<li>Primary suppression using <code>primarySuppression</code></li>
<li>Secondary suppression using <code>protectTable</code></li>
<li>Review outputs using <code>getInfo</code></li>
</ol>
<p>The objects created at steps 2, 3 and 4 have a class and structure which is specific to the package <code>sdcTable</code>. They may appear complex at first, but we will see how to get the necessary information out of them.</p>
<p>Later sections will show more complex cases which will be presented as variations of this simple example.</p>
<div id="defining-hierachies" class="section level3">
<h3>1. Defining hierachies</h3>
<p>We need to define a hierarchy for each of our two dimensions <code>County</code> and <code>Aid</code> which we shall call <code>dimCounty</code> and <code>dimAid</code>. These are created using the <code>hier_create</code> function from the <code>sdcTable</code> package as shown below. The total category is identified as the ‘root’ of the hierarchy. Note that this total name/classification does not exist in the microdata. The underlying classifications are then created using the <code>nodes</code> argument to the function. There are other ways of creating hierarchies, either as a matrix or by creating them in a csv and importing that, which could be useful if you have a hierarchy with a large number of classifications.</p>
<pre class="r"><code>dimCounty &lt;- hier_create(root = &quot;Connaught&quot;,
                         nodes = c(&quot;Galway&quot;,
                                   &quot;Leitrim&quot;,
                                   &quot;Mayo&quot;,
                                   &quot;Roscommon&quot;,
                                   &quot;Sligo&quot;))

dimAid &lt;- hier_create(root = &quot;All companies&quot;,
                      nodes = c(&quot;Y&quot;,
                                &quot;N&quot;))</code></pre>
<p>We can view our hierarchies using the function <code>hier_display</code>.</p>
<pre class="r"><code>hier_display(dimCounty)</code></pre>
<pre><code>## Connaught
## +-Galway
## +-Leitrim
## +-Mayo
## +-Roscommon
## \-Sligo</code></pre>
<pre class="r"><code>hier_display(dimAid)</code></pre>
<pre><code>## All companies
## +-Y
## \-N</code></pre>
</div>
<div id="setting-up-the-sdc-problem" class="section level3">
<h3>2. Setting up the SDC problem</h3>
<p>We use the function <code>makeProblem</code> to create an object of class <code>sdcProblem</code> as shown below. We are making use of three arguments: <code>data</code>, which is the dataset containing the microdata; <code>dimList</code>, which is a list object containing the hierarchies that we have created, each identified using a name which matches the name of the variable as it appears in the microdata; and <code>numVarInd</code>, the name of the variable containing the numerical data that we want to aggregate.</p>
<pre class="r"><code>sales_sdc_problem &lt;- makeProblem(data = company_sales_1,
                           dimList = list(County = dimCounty, Aid = dimAid),
                           numVarInd = &quot;Sales&quot;)</code></pre>
<p>The object <code>sales_sdc_problem</code> has a specific class called ‘sdcProblem’. It contains information about the microdata, the hierarchies, and protection parameters generated by the function <code>makeProblem</code>. To learn more about the contents of this object see the <a href="https://www.rdocumentation.org/packages/sdcTable/versions/0.31/topics/sdcProblem-class">documentation</a>. In the next step we will use it to carry out primary suppression.</p>
</div>
<div id="primary-suppression" class="section level3">
<h3>3. Primary suppression</h3>
<p>Primary suppression is carried out using the function <code>primarySuppression</code>. The first argument is the sdcProblem object (<code>sales_sdc_problem</code>, in our case), and the second argument is <code>type</code>. This can take one of four values:</p>
<ul>
<li><code>"freq"</code> for frequency rule with additional parameter <code>maxN</code> for the maximum number of entities in an unsafe cell (default value is 3)</li>
<li><code>"nk"</code> for nk-dominance rule with additional parameters <code>n</code> and <code>k</code> (defaults of 2 and 85 respectively, meaning that in a safe cell two entities cannot contribute more than 85% of the aggregate value)</li>
<li><code>"p"</code> for p-percent rule with additional parameter <code>p</code> (default value of 80, meaning that in a safe cell, if the two largest contributors were removed then the remaining value has to be greater than 80% of the largest contributor)</li>
<li><code>"pq"</code> for the pq-rule with additional parameter <code>pq</code> which is a vector of length two. (The default value of pq is <code>c(25,50)</code>, meaning that in a safe cell, if the two largest contributors are removed then 50% of the remaining value should be greater than 25% of the largest contributor.)</li>
</ul>
<p>For the <code>"nk"</code>, <code>"p"</code> and <code>"pq"</code> options there is one further mandatory argument to define the name of numerical variable which is <code>numVarName</code>.</p>
<p>Here we’ll use the nk-dominance rule with default parameters:</p>
<pre class="r"><code>sales_sdc_primary &lt;- primarySuppression(sales_sdc_problem, 
                                        type = &quot;nk&quot;, 
                                        numVarName = &quot;Sales&quot;)</code></pre>
<p>The output from this function, which we have called <code>sales_sdc_primary</code>, is of the same class ‘sdcProblem’ as the input object <code>sales_sdc_problem</code>. However the primary suppression rule has been implemented which we can see if we look at the slot called ‘sdcStatus’. We can use the function <code>getInfo</code> to do this. This function is part of the sdcTable package, and it allows us to query the objects that are made through the suppression process. Here we see that in <code>sales_sdc_problem</code> there are 18 cells marked ‘s’ for ‘safe’, but in <code>sales_sdc_primary</code> which has had primary suppression applied, there is one cell marked ‘u’ for ‘unsafe’.</p>
<pre class="r"><code>getInfo(sales_sdc_problem, type=&quot;sdcStatus&quot;)</code></pre>
<pre><code>##  [1] &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot;</code></pre>
<pre class="r"><code>getInfo(sales_sdc_primary, type=&quot;sdcStatus&quot;)</code></pre>
<pre><code>##  [1] &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;u&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot; &quot;s&quot;</code></pre>
</div>
<div id="secondary-suppression" class="section level3">
<h3>4. Secondary suppression</h3>
<p>Secondary suppression is carried out using the function <code>protectTable</code> which has two main arguments. The first argument is the sdcProblem object to which primary suppression has already been applied (<code>sales_sdc_primary</code> in our case). The second main argument is <code>method</code> which allows us to choose an algorithm for secondary suppression. There are four options, and here I am copying the descriptions from the <a href="https://www.rdocumentation.org/packages/sdcTable/versions/0.32.2/topics/protectTable">Help page for this function</a>:</p>
<ul>
<li>“OPT”: protect the complete problem at once using a cut and branch algorithm. The optimal algorithm should be used for small problem-instances only.</li>
<li>“HITAS”: split the overall problem in smaller problems. These problems are protected using a top-down approach.</li>
<li>“HYPERCUBE”: protect the complete problem by protecting sub-tables with a fast heuristic that is based on finding and suppressing geometric structures (n-dimensional cubes) that are required to protect primary sensitive table cells.</li>
<li>“SIMPLEHEURISTIC” and “SIMPLEHEURISTIC_OLD”: heuristic procedures which might be applied to large(r) problem instances.</li>
</ul>
<p>There are some other arguments for parameters to these algorithms that can be varied but I have not used them. You can investigate them yourself on the <a href="https://www.rdocumentation.org/packages/sdcTable/versions/0.32.2/topics/protectTable">Help page for <code>protectTable</code></a>.</p>
<pre class="r"><code>sales_sdc_secondary &lt;- protectTable(sales_sdc_primary, method = &quot;HITAS&quot;)</code></pre>
<p>The resulting object has both primary and secondary suppression applied. The next section shows how to view the results.</p>
</div>
<div id="reviewing-outputs" class="section level3">
<h3>5. Reviewing outputs</h3>
<p>You can view the suppression results by extracting the <code>finalData</code> information from <code>sales_sdc_secondary</code> using the <code>getInfo</code> function. As you can see in the output printed below there is a new column called <code>sdcStatus</code>. It takes a value of <code>s</code> for safe cells, <code>u</code> for unsafe cells (as determined in the primary suppression), and <code>x</code> for cells that are deemed unsafe by the secondary suppression algorithm. We can see below that there is one ‘unsafe’ cell which relates to companies in Leitrim that received Aid. Since the total figure for Leitrim is also given (row 7 in the output shown) the secondary suppression of Leitrim companies that did not receive Aid is required. And since the total figure for all companies in Connaught that did and did not receive Aid is given (rows 2 and 3), suppression of one other county is also required. In this case the algorithm has chosen Sligo (rows 17 and 18).</p>
<pre class="r"><code>sdc_output &lt;- getInfo(sales_sdc_secondary , type = &quot;finalData&quot;)

print(sdc_output)</code></pre>
<pre><code>##        County           Aid Freq Sales sdcStatus
##  1: Connaught All companies   60 28703         s
##  2: Connaught             Y   26 13127         s
##  3: Connaught             N   34 15576         s
##  4:    Galway All companies   20  9656         s
##  5:    Galway             Y    9  4770         s
##  6:    Galway             N   11  4886         s
##  7:   Leitrim All companies    8  2658         s
##  8:   Leitrim             Y    4  1252         u
##  9:   Leitrim             N    4  1406         x
## 10:      Mayo All companies   10  4738         s
## 11:      Mayo             Y    4  2516         s
## 12:      Mayo             N    6  2222         s
## 13: Roscommon All companies   12  6660         s
## 14: Roscommon             Y    5  2408         s
## 15: Roscommon             N    7  4252         s
## 16:     Sligo All companies   10  4991         s
## 17:     Sligo             Y    4  2181         x
## 18:     Sligo             N    6  2810         x</code></pre>
<p>The variable <code>sdcStatus</code> can also take a value <code>z</code>, and we will see later that this can come about when we override the secondary suppression to publish certain cross-tabulations.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
