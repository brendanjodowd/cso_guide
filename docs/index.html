<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Brendan O’Dowd" />


<title>Making maps of Ireland in R</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Making maps of Ireland in R</h1>
<h4 class="author">Brendan O’Dowd</h4>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This guide uses <a href="https://github.com/brendanjodowd/maps">maps from my GitHub page</a> produced using shapefiles from <a href="https://data-osi.opendata.arcgis.com/">OSi</a> and <a href="https://www.spatialni.gov.uk/">OSNI</a>.</p>
<p>Two packages are used throughout, they are <a href="https://tidyverse.tidyverse.org/">tidyverse</a> (actually a collection of packages) and <a href="https://r-spatial.github.io/sf/">sf</a>, which stands for simple features. To install any package run <code>install.packages("package_name")</code>.</p>
<p>To start, we will need to load both of these packages.</p>
<pre class="r"><code>library(tidyverse)
library(sf)</code></pre>
</div>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<p>I would like for anyone to be able to begin making their own maps, but some familiarity with R is ideal. I think that in order to produce maps independently you should be able to use the following list of functions. The help function in R is very useful, you can find out about a function using <code>?</code>, for example by entering <code>?select</code>.</p>
<ul>
<li><code>&lt;-</code> : the assignment operator in R (shortcut Alt -). E.g. <code>x &lt;- 5</code> gives <code>x</code> the value 5.</li>
<li><code>select()</code> : subsetting columns</li>
<li><code>filter()</code> : subsetting rows</li>
<li><code>mutate()</code> : create new variables</li>
<li><code>group_by()</code> : prepares a dataframe for operations to be carried out on groups of variables. Use <code>ungroup()</code> to remove grouping.</li>
<li><code>%&gt;%</code> : this is the ‘pipe’ (shortcut Ctrl Shift m), it is a tool for pushing an object through a series of operations. It makes code easier to read and write.</li>
<li><code>c()</code> : create a vector.</li>
<li>Logical operators like <code>==</code> (equal to) <code>!=</code> (not equal to) <code>&amp;</code> (and) <code>|</code> (or) <code>%in%</code> (in, I use this a lot to see if a string is in a vector of strings).</li>
</ul>
<p>Not an absolute necessity, but I find myself doing a lot of string matching when I’m making maps in R, and for that I use the <code>str_detect()</code> function. A very useful resource is the ‘String manipulation with stringr cheatsheet’, available on the <a href="https://www.rstudio.com/resources/cheatsheets/">RStudio Cheatsheets page</a>.</p>
</div>
<div id="importing-maps" class="section level2">
<h2>Importing maps</h2>
<p>You <strong>should</strong> be able to import my maps directly from the web, using the following, which will create an object called <code>lea_166</code>.</p>
<pre class="r"><code>lea_166 &lt;- st_read(&quot;https://raw.githubusercontent.com/brendanjodowd/maps/main/lea_166.geojson&quot;)</code></pre>
<p>This is a map of the 166 Local Electoral Areas in Ireland, plus the outline for Northern Ireland, so there are 167 shapes in total, and a row for each of these, so 167 rows in <code>lea_166</code>. In terms of structure, <code>lea_166</code> is an ‘sf object’, where sf stands for special features (check by running <code>class(lea_166)</code>). This is a special type of dataframe where one of the columns is called <code>geometry</code> and contains the coordinates for the shapes corresponding to that row.</p>
<p>I say <strong>should</strong> in the above because your organisation might not allow R to access the web in this way. If that’s the case then you can navigate to the URL in the <code>st_read()</code> function, and save that page locally as a .geojson file. Then use the file location on your PC as the argument for <code>st_read()</code>.</p>
<p>We will be able to use this map of 166 LEAs (plus Northern Ireland) to create other maps, such as county outlines and NUTS 3 region outlines.</p>
<p>There are 11 columns within <code>lea_166</code>, they are:</p>
<ul>
<li>LE_ID : an id sometimes used by CSO</li>
<li>LEA: The name of the LEA</li>
<li>COUNTY: The county of the LEA</li>
<li>AREA: area in square kilometres</li>
<li>GUID: Globally Unique Identification code, another type of ID</li>
<li>NUTS3 and NUTS2: NUTS (Nomenclature of Territorial Units for Statistics) regions are standard country subdivisions used for statistical purposes.</li>
<li>ADMIN_AREA: Ireland’s 31 administrative areas. Like COUNTY, except Dublin, Cork, Galway and Limerick are broken up.</li>
<li>cso_name: a version of the name of the LEA which may be matched to CSO datasets</li>
<li>Pop2016: The population of the LEA according to Census 2016 data.</li>
<li>geometry: a list-column containing the geographic coordinates for each LEA.</li>
</ul>
<p>You can have a look at <code>lea_166</code> using the <code>glimpse()</code> function:</p>
<pre class="r"><code>glimpse(lea_166)</code></pre>
<pre><code>## Rows: 167
## Columns: 11
## $ LE_ID      &lt;chr&gt; &quot;13160403&quot;, &quot;13210401&quot;, &quot;13180401&quot;, &quot;1360401&quot;, &quot;13100400&quot;, &quot;13230402~
## $ LEA        &lt;chr&gt; &quot;Ratoath&quot;, &quot;Roscrea-Templemore&quot;, &quot;Tullamore&quot;, &quot;Tuam&quot;, &quot;Borris-in-Oss~
## $ COUNTY     &lt;chr&gt; &quot;Meath&quot;, &quot;Tipperary&quot;, &quot;Offaly&quot;, &quot;Galway&quot;, &quot;Laois&quot;, &quot;Westmeath&quot;, &quot;Dub~
## $ AREA       &lt;dbl&gt; 294.98056, 492.84520, 399.42957, 780.69255, 907.57781, 713.83629, 9.~
## $ GUID       &lt;chr&gt; &quot;2ae19629-3f1b-13a3-e055-000000000001&quot;, &quot;2ae19629-3f2d-13a3-e055-000~
## $ NUTS3      &lt;chr&gt; &quot;Mid-East&quot;, &quot;Mid-West&quot;, &quot;Midlands&quot;, &quot;West&quot;, &quot;Midlands&quot;, &quot;Midlands&quot;, ~
## $ NUTS2      &lt;chr&gt; &quot;Eastern and Midland&quot;, &quot;Southern&quot;, &quot;Eastern and Midland&quot;, &quot;Northern ~
## $ ADMIN_AREA &lt;chr&gt; &quot;MEATH&quot;, &quot;TIPPERARY&quot;, &quot;OFFALY&quot;, &quot;GALWAY COUNTY&quot;, &quot;LAOIS&quot;, &quot;WESTMEATH~
## $ cso_name   &lt;chr&gt; &quot;Ratoath, Meath&quot;, &quot;Roscrea-Templemore, Tipperary&quot;, &quot;Tullamore, Offal~
## $ Pop2016    &lt;dbl&gt; 33318, 16594, 29159, 33191, 24807, 21674, 41593, 13771, 26595, 17255~
## $ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-6.662222 5..., MULTIPOLYGON (((-8.0549~</code></pre>
</div>
<div id="first-plot" class="section level2">
<h2>First plot</h2>
<p>Let’s take a quick look at the map that we now have using ggplot. ggplot is one of the packages within tidyverse which is very useful for making all kinds of nice plots).</p>
<pre class="r"><code>ggplot() + geom_sf(data= lea_166)</code></pre>
<p><img src="index_files/figure-html/first_plot%20-1.png" width="672" /></p>
<p>This structure of using <code>ggplot()</code> followed by <code>+ geom_XXX()</code> will be familiar to users of ggplot (<code>XXX</code> here might be <code>line</code>, <code>bar</code> etc. depending on the type of plot).</p>
<p>Note that the following piece of code is equivalent, and doesn’t require <code>data =</code>:</p>
<pre class="r"><code>ggplot(lea_166) + geom_sf()</code></pre>
<p>Even though this layout is probably more commonly used, I will be using the previous layout because later on I’ll be using multiple <code>geom_sf()</code> functions to build up a plot in layers, and I find that the dataframe being used is less ambiguous that way.</p>
</div>
<div id="aggregating-up-for-counties-and-nuts-regions" class="section level2">
<h2>Aggregating up for counties and NUTS regions</h2>
<p>Maps for counties, admin areas, NUTS2 and NUTS3 regions can be produced using <code>lea_166</code>. To produce a map of counties, for example, use the code below. The key function here is <code>st_union()</code> which can be used to join sf objects.</p>
<pre class="r"><code>county_map &lt;- lea_166 %&gt;% 
  group_by(COUNTY) %&gt;% 
  summarise(geometry = st_union(geometry) , AREA=sum(AREA))</code></pre>
<p>Note that <code>county_map</code> has only 3 columns, which are <code>COUNTY</code>, <code>geometry</code> and <code>AREA</code>. <code>AREA</code> is calculated for each county using the <code>sum()</code> function above. You could do something similar for <code>Pop2016</code> if you wished. All other columns are lost in the <code>summarise()</code> step.</p>
<p>Let’s plot <code>county_map</code> to see what it looks like.</p>
<pre class="r"><code>ggplot() + geom_sf(data=county_map)</code></pre>
<p><img src="index_files/figure-html/county_plot%20-1.png" width="672" /></p>
<p>Try making a similar plot of the NUTS3 regions.</p>
</div>
<div id="colouring-in-selected-areas-of-the-map" class="section level2">
<h2>Colouring in selected areas of the map</h2>
<p>Let’s start with the LEA map and let’s say we want all of the LEAs in the Border to be coloured in green. We can make a new dataframe called <code>border_leas</code> using filter as follows:</p>
<pre class="r"><code>border_leas &lt;- lea_166 %&gt;% 
  filter(NUTS3 == &quot;Border&quot;)</code></pre>
<p>Now we can plot that as an extra layer on top of our usual LEA map</p>
<pre class="r"><code>ggplot() + 
  geom_sf(data = lea_166) +
  geom_sf(data = border_leas , fill=&quot;green&quot;)</code></pre>
<p><img src="index_files/figure-html/first_green_plot%20-1.png" width="672" /></p>
<p>Note that we could have done the filter step within the <code>geom_sf()</code> function if we wanted to, like so:</p>
<pre class="r"><code>ggplot() + 
  geom_sf(data = lea_166) +
  geom_sf(data = lea_166 %&gt;% filter(NUTS3 == &quot;Border&quot;) , fill=&quot;green&quot;)</code></pre>
<p>The filter function is very powerful, and we can include multiple clauses separated by commas. Let’s say we want all LEAs in the Border and South-West NUTS 3 regions or in County Offaly, and excluding the LEA of Kenmare and any LEA that includes the string ‘Cork City’. I know this seems like a silly collection but hopefully it will give you a guide to making your own complex subsets.</p>
<pre class="r"><code>selected_areas &lt;- lea_166 %&gt;% 
  filter(NUTS3 %in% c(&quot;Border&quot; ,&quot;South-West&quot;) | COUNTY ==&quot;Offaly&quot; , 
         LEA != &quot;Kenmare&quot;, 
         ! str_detect(LEA , &quot;Cork City&quot;)) </code></pre>
<p>Note the use of <code>!</code> above in front of the <code>str_detect</code> function, which negates or produces the opposite of the logical expression in front of it. You could have used <code>&amp;</code> instead of the commas in the argument of <code>filter</code> above, but using logical AND as well as logical OR can be unambiguous, so you should use extra brackets if doing so. Anyway, let’s plot <code>selected_areas</code>.</p>
<pre class="r"><code>ggplot() + 
  geom_sf(data = lea_166) +
  geom_sf(data = selected_areas , fill=&quot;green&quot;)</code></pre>
<p><img src="index_files/figure-html/second_green_plot%20-1.png" width="672" /></p>
</div>
<div id="adding-more-layers-and-using-theme_void" class="section level2">
<h2>Adding more layers and using <code>theme_void()</code></h2>
<p>Let’s take the previous map and add dark outlines for the NUTS 3 regions. I’m going to set <code>fill</code> to <code>NA</code> which means it won’t have any fill colour, then set the line colour to black using <code>colour="black"</code>, and I’ll set the line width to 1 using <code>size=1</code>.</p>
<p>Let’s add another coloured layer, we’ll make all of Dublin blue. The line of code for this will need to go before the NUTS 3 outline, otherwise it will partially obscure that outline.</p>
<p>I’m also going to add <code>theme_void()</code> here. With ggplot there are lots of different themes you can add to change the appearance of your plot, but for maps the only one I really use is <code>theme_void()</code>. It’s effect is to remove the axes and give you a clear background.</p>
<pre class="r"><code>nuts_outline &lt;- lea_166 %&gt;% 
  group_by(NUTS3) %&gt;% 
  summarise(geometry = st_union(geometry))

ggplot() + 
  geom_sf(data = lea_166) +
  geom_sf(data = selected_areas , fill=&quot;green&quot;) +
  geom_sf(data = lea_166 %&gt;% filter(COUNTY==&quot;Dublin&quot;) , fill=&quot;blue&quot;) +
  geom_sf(data = nuts_outline , fill= NA , colour=&quot;black&quot;, size=1) +
  theme_void()</code></pre>
<p><img src="index_files/figure-html/nuts_outline%20-1.png" width="672" /></p>
</div>
<div id="assigning-plots-to-an-object-with-a-name" class="section level2">
<h2>Assigning plots to an object with a name</h2>
<p>Rather than simply plotting a ggplot object immediately, you can turn it into an object in the R environment with its own name. For example, let’s take the first three lines of the previous <code>ggplot</code> statement and make an object called <code>base_plot</code>:</p>
<pre class="r"><code>base_plot &lt;- ggplot() + 
  geom_sf(data = lea_166) +
  geom_sf(data = selected_areas , fill=&quot;green&quot;) </code></pre>
<p>Now we can add to this as we please (resulting plot not shown, same as previous image). You might like to try this approach if you are making several plots which have a certain amount of detail in common.</p>
<pre class="r"><code>base_plot + 
  geom_sf(data = lea_166 %&gt;% filter(COUNTY==&quot;Dublin&quot;) , fill=&quot;blue&quot;) +
  geom_sf(data = nuts_outline , fill= NA , colour=&quot;black&quot;, size=1) +
  theme_void()  </code></pre>
<p><img src="index_files/figure-html/base_plot_2%20-1.png" width="672" /></p>
</div>
<div id="saving-plots" class="section level2">
<h2>Saving plots</h2>
<p>The function used to save plots is <code>ggsave</code>. By default it saves the last plot displayed. Here is how it is used:</p>
<pre class="r"><code>ggsave(file = &quot;images/map_with_selected_areas.png&quot; , width=18, height = 24, units=&quot;cm&quot;) </code></pre>
<p>You can save a named plot to file by creating a named object from a <code>ggplot</code> statement and passing that to <code>ggsave</code> using <code>plot =</code></p>
<pre class="r"><code>simple_lea_map &lt;- ggplot() + geom_sf(data = lea_166)

ggsave(file = &quot;images/simple_lea_map.png&quot; , plot = simple_lea_map, width=18, height = 24, units=&quot;cm&quot;) </code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
